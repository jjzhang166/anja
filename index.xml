<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="html.xsl"?>
<document>
	<title>Anja user's guide</title>
	<author>Torbjörn Rathsman</author>
	<titlepic>
		<includegraphics src="anjalogo-hires.png" media="(min-width:1024px)" />
		<includegraphics src="anjalogo.png" media="(max-width:1024px)" />
	</titlepic>

	<abstract>
		<p>Anja is a sample player designed for live sound effect playback. Anja makes it possible to assign sound effects to the keys of the computer keyboard. Anja also featues a channel mixer with 16 channels, making it possible to fade a group of sound effects together. The backend of Anja is JACK, the low-latency audio server. The session file format of Anja is in a formalized text format, optimized for human readability.</p>
	</abstract>

	<tableofcontents />

	<chapter id="intro">Introduction</chapter>
	<p><strong>Anja</strong> is a sample player designed for live sound effect playback. Anja makes it possible to assign sound effects to the keys typing keys of the computer keyboard. To make it easier to find sound effects, each sound effect can have a description and a color, that shows up on Anja's virtual computer keyboard.</p>

	<p>Anja also featues a channel mixer with 16 channels. All sound effects are routed through one of these channels. The channel mixer makes it possible to fade a group of sound effects together. As with sound effects, each channel has a color and a description. In addition to color, description and channel gain, each channel also has an adjustable fade time, that is used to automatically fade the channel.</p>

	<p>The backend of Anja is JACK, the low-latency audio server<cite>jack</cite>. This makes it possible to connect Anja to other JACK clients enabling the creation of more complex signal flows.</p>

	<p>The session file format of Anja is in a formalized text format, optimized for human readability. The syntax of the session files has taken inspiration from formats such as Markdown<cite>markdown</cite> and is very similar to the syntax used in the "Doom template file"<cite>doomwiki</cite>. Therefore, session files can be easiliy edited by hand in a text editor, to the price of somewhat larger session files.</p>

	<section id="requirements">System requirements</section>
	<p>To run Anja, a working installation of JACK<cite>jack</cite> is required. Moreover, Anja requires <libname>libsndfile</libname> and <libname>GTK+</libname> version 3. Anja runs smoothly on an Intel® Pentium® M, and thus, it is only moderately CPU demanding. However, since Anja completely loads all sound files referenced from a session file, it may consume some RAM. At <quantity unit="kHz">48</quantity>, the RAM usage is <quantity unit="MiB/min">11</quantity> of sound. The minimum screen resolution for running Anja in fullscreen mode is <quantity unit="px">923</quantity> &#215; <quantity unit="px">599</quantity>. In windowed mode, the required screen resolution depends on the windowing system, but it is approximately <quantity unit="px">930</quantity> &#215; <quantity unit="px">630</quantity>.</p>


	<section id="comparison">Anja compared to other software</section>
	<p>There are other sample players that also may be used with JACK. One such program is Hydrogen<cite>hydrogen</cite>. Compared to Hydrogen, Anja lacks a sequencer. However, in Hydrogen, waveforms need to be assigned in a particular order, and Hydrogen does not feature an on-screen keyboard. Other features in Anja is event-triggerd auto-fade, and also a kill-all-softly feature.</p>

	<chapter id="install">Installing Anja</chapter>
	<p>Before Anja can be used, the program needs to be installed. This chapter goes through the installation procedure</p>

	<section id="installlinux">Installing on a GNU/Linux system</section>

	<p>On GNU/Linux, the recommended way of installing Anja is to install it from the software repository. If there is no package available, download the source package<cite>anjasrc</cite>, and compile it. Assuming all dependencies are met, following the procedure in <ref>installscript</ref> should work.</p>
	<listing id="installscript">
		<caption>Installation script that can be used on a GNU/Linux system</caption>
		<code language="bash">#!/bin/bash
#This script downloads and compiles the latest Anja release

#Get the download URL
ANJA_SRC=`wget -q -O - https://api.github.com/repos/milasudril/anja/releases \
	| grep 'tarball_url' | head -n 1 | cut -d '"' -f 4`

#Download anja
wget -O anja.tar.gz "$ANJA_SRC"

#Extract the contents
SRC_DIR=`tar -xvf anja.tar.gz | head -n 1`
tar -xf anja.tar.gz

#Change directory
cd "$SRC_DIR"

#Complie
make</code>
</listing>
<p>When running <prgname>make</prgname>, files are written to <dirname>__wand_targets_rel</dirname>. After the compilation has completed, Anja can be launched directly by running the command</p>
<code language="bash">__wand_targets_rel/anja</code>

	<p>To make it easier to launch Anja, you can move it to a place mentioned in the <env>PATH</env> variable. For example, if you have <prgname>sudo</prgname> permissions, you can do</p>
<code language="bash">sudo mv __wand_targets_rel/anja /usr/local/bin</code>
<p>If you do not have <prgname>sudo</prgname> permissions, you can move it to <dirname>~/bin</dirname> instead:</p>
<code language="bash">mv __wand_targets_rel/anja ~/bin</code>

	<subsection id="deps">Obtaining all dependencies</subsection>
	<p>The procedure listed in <ref>installscript</ref> assumed that all dependencies already are satisfied. On a Debian based system, all dependencies can be obtained by invoking the commands listed in <ref>debs</ref>.</p>
	<listing id="debs"><caption>Commands used to install all dependencies before compiling Anja on a Debian based system</caption><code language="bash">#!/bin/bash
#Install dependencies. These commands needs to be run before compiling Anja

sudo apt-get install libgtk-3-dev
sudo apt-get install libsndfile1-dev
sudo apt-get install jackd
sudo apt-get install libjack-jackd2-dev</code>
	</listing>

	<chapter id="using">Using Anja</chapter>
	<p>Starting Anja without any command line arguments brings up a window that looks like the one presented in <ref>anjastart</ref>. The workspace consits of three main parts annotated in <ref>anjaworkspace</ref>. To the left, there the <dfn>Action panel</dfn> a panel with different buttons that affect Anja's current state. To the right of that, the <dfn>Keyboard view</dfn> is located, and below that, there is a <dfn>Settings panel</dfn>, controling which waveforms are loaded as well as the playback of loaded waveforms. Above the <dfn>Keyboard view</dfn>, there is an area for text messages indicating the state of the audio engine. The meaning of all possible messages are listed in <ref>anjastate</ref>.</p>

	<figure id="anjastart">
		<includegraphics src="mainwindow-start.png" />
		<caption>The Anja window, as shown after launching Anja without any command line arguments</caption>
	</figure>

	<figure id="anjaworkspace">
		<includegraphics src="anjaworkspace.png" />
		<caption>The different parts of the Anja workspace. (1) is the <dfn>Action panel</dfn>, used to control Anja's state, (2) is the <dfn>Keyboard view</dfn>, which selects waveform slots and channels, and (3) is the <dfn>Settings panel</dfn>, which controls which loads waveforms and controls the playback of loaded waveforms.</caption>
	</figure>

	<section id="addfx">Loading a waveform</section>
	<p>To load a waveform, choose a slot by clicking on the corresponding key in the <dfn>Keyboard view</dfn>. It is possible to choose any key except one of the function keys, but it is recommended to avoid the keys <kbd>Alt</kbd> and <kbd>❖</kbd>. After choosing a slot click <ui-button>Browse...</ui-button> to the right of <ui-formfield>Source</ui-formfield> field now visible in th <dfn>Settings panel</dfn>. This brings up a file selection dialog. It is also possible to type a filename directly in the text input field to the left of <ui-button>Browse...</ui-button>.</p>

	<infobox type="warning">In case a multi-channel audio file is loaded, only the data for the first (usually the "left" channel) will be loaded. This is because Anja uses mono waveforms. For information about playing multi-channel audio, see <ref>playback_advanced</ref>.
	</infobox>

	<section id="play">Playing waveforms</section>
	<p>Before any sound can be heard from Anja, the <dfn>audio engine</dfn> has to be running. The <dfn>audio engine</dfn> is started by clicking the button <ui-button>Start engine</ui-button> in the <dfn>Action panel</dfn>. Now, when the engine is running, there should be a new JACK client with a name that derived from the name of the current Anja session. For example, after starting the engine on the default session, there should be a JACK client called <env>New session.anja</env>. To list all JACK clients and ports open a teminal and type</p>

	<code language="bash">jack_lsp</code>

	<p>If you did not load any old session, or have not modified the default session, you will see something like</p>
	<code language="nohighlight">system:capture_1
system:capture_2
system:playback_1
system:playback_2
New session.anja:Master out
New session.anja:Audio capture
New session.anja:MIDI in
New session.anja:MIDI out</code>
<p>The interesting port in this case is <dirname>New session.anja:Master out</dirname>. Connecting this port to <dirname>system:playback_1</dirname> and <dirname>system:playback_2</dirname> will enable sound output from Anja to the left and right speaker (or what ever is connected to the corresponding audio output ports of the computer). JACK ports can be connected by using the command <prgname>jack_connect</prgname><cite>manjack</cite>. The command to connect these ports would be</p>
<code language="bash">jack_connect 'New session.anja:Master out' 'system:playback_1'
jack_connect 'New session.anja:Master out' 'system:playback_2'
</code>
<p>The status message (see <ref>anjastate</ref>) suggests using a JACK patchbay tool such as <prgname>Catia</prgname><cite>catia</cite> shown in <ref>catia</ref>. In <prgname>Catia</prgname> ports can be connected using "Drag and drop".</p>

<p>When the <dfn>audio engine</dfn> is started, and the output port is connected, a loaded waveform can be played by hitting the corresponding key on the computer keyboard.</p>

<infobox type="warning">Trigging playback through the computer keyboard is only possible when the <dfn>Keyboard view</dfn> has keyboard focus. This is indicated by a green rectangle.</infobox>

<figure id="catia">
	<includegraphics src="catiaanja.png"/>
	<caption>Anja with an Anja session started</caption>
</figure>

	<bibliography>
		<item id="anjasrc">Anja source archive <url>https://github.com/milasudril/anja/releases/latest</url></item>
		<item id="jack">JACK Audio Connection Kit <url>http://jackaudio.org</url></item>
		<item id="markdown">Daring Firball: Markdown <url>https://daringfireball.net/projects/markdown</url></item>
		<item id="doomwiki">Doom file template <url>http://doom.wikia.com/wiki/Doom_file_template</url></item>
		<item id="hydrogen">Hydrogen <url>http://www.hydrogen-music.org/hcms</url></item>
		<item id="manjack"><prgname>jack_connect</prgname> manual page</item>
		<item id="catia">... <url>http://kxstudio.org</url></item>
	</bibliography>
</document>
